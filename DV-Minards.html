<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <!-- Stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Cabin:500" rel="stylesheet" type="text/css" />
    <!-- Libraries -->
    <script src="d3/d3.min.js"></script>
    <!-- Scripts -->

    <style>
        body {
            background-color: black;
            color: white;
        }
        
        .label {
            color: white;
        }
        
        h1 {
            text-align: center;
        }
    </style>
</head>

<body>
    <h1>Minard's Map</h1>

    <script>
        var data = [{
            LONC: "24",
            LATC: "55",
            CITY: "Kowno",
            LONT: "37.6",
            TEMP: "0",
            DAYS: "6",
            MON: "Oct",
            DAY: "18",
            LONP: "24",
            LATP: "54.9",
            SURV: "340000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "25.3",
            LATC: "54.7",
            CITY: "Wilna",
            LONT: "36",
            TEMP: "0",
            DAYS: "6",
            MON: "Oct",
            DAY: "24",
            LONP: "24.5",
            LATP: "55",
            SURV: "340000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "26.4",
            LATC: "54.4",
            CITY: "Smorgoni",
            LONT: "33.2",
            TEMP: "-9",
            DAYS: "16",
            MON: "Nov",
            DAY: "9",
            LONP: "25.5",
            LATP: "54.5",
            SURV: "340000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "26.8",
            LATC: "54.3",
            CITY: "Molodexno",
            LONT: "32",
            TEMP: "-21",
            DAYS: "5",
            MON: "Nov",
            DAY: "14",
            LONP: "26",
            LATP: "54.7",
            SURV: "320000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "27.7",
            LATC: "55.2",
            CITY: "Gloubokoe",
            LONT: "29.2",
            TEMP: "-11",
            DAYS: "10",
            MON: "",
            DAY: "",
            LONP: "27",
            LATP: "54.8",
            SURV: "300000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "27.6",
            LATC: "53.9",
            CITY: "Minsk",
            LONT: "28.5",
            TEMP: "-20",
            DAYS: "4",
            MON: "Nov",
            DAY: "28",
            LONP: "28",
            LATP: "54.9",
            SURV: "280000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "28.5",
            LATC: "54.3",
            CITY: "Studienska",
            LONT: "27.2",
            TEMP: "-24",
            DAYS: "3",
            MON: "Dec",
            DAY: "1",
            LONP: "28.5",
            LATP: "55",
            SURV: "240000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "28.7",
            LATC: "55.5",
            CITY: "Polotzk",
            LONT: "26.7",
            TEMP: "-30",
            DAYS: "5",
            MON: "Dec",
            DAY: "6",
            LONP: "29",
            LATP: "55.1",
            SURV: "210000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "29.2",
            LATC: "54.4",
            CITY: "Bobr",
            LONT: "25.3",
            TEMP: "-26",
            DAYS: "1",
            MON: "Dec",
            DAY: "7",
            LONP: "30",
            LATP: "55.2",
            SURV: "180000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "30.2",
            LATC: "55.3",
            CITY: "Witebsk",
            LONP: "30.3",
            LATP: "55.3",
            SURV: "175000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "30.4",
            LATC: "54.5",
            CITY: "Orscha",
            LONP: "32",
            LATP: "54.8",
            SURV: "145000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "30.4",
            LATC: "53.9",
            CITY: "Mohilow",
            LONP: "33.2",
            LATP: "54.9",
            SURV: "140000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "32",
            LATC: "54.8",
            CITY: "Smolensk",
            LONP: "34.4",
            LATP: "55.5",
            SURV: "127100",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "33.2",
            LATC: "54.9",
            CITY: "Dorogobouge",
            LONP: "35.5",
            LATP: "55.4",
            SURV: "100000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "34.3",
            LATC: "55.2",
            CITY: "Wixma",
            LONP: "36",
            LATP: "55.5",
            SURV: "100000",
            DIR: "A",
            DIV: "1",
        }, {
            LONC: "34.4",
            LATC: "55.5",
            CITY: "Chjat",
            LONP: "37.6",
            LATP: "55.8",
            SURV: "100000",
            DIR: "R",
            DIV: "1",
        }, {
            LONC: "36",
            LATC: "55.5",
            CITY: "Mojaisk",
            LONP: "37.5",
            LATP: "55.7",
            SURV: "98000",
            DIR: "R",
            DIV: "1",
        }, {
            LONC: "37.6",
            LATC: "55.8",
            CITY: "Moscou",
            LONP: "37",
            LATP: "55",
            SURV: "97000",
            DIR: "R",
            DIV: "1",
        }, {
            LONC: "36.6",
            LATC: "55.3",
            CITY: "Tarantino",
            LONP: "36.8",
            LATP: "55",
            SURV: "96000",
            DIR: "R",
            DIV: "1",
        }, {
            LONC: "36.5",
            LATC: "55",
            CITY: "Malo-jarosewli",
            LONP: "35.4",
            LATP: "55.3",
            SURV: "87000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "34.3",
            LATP: "55.2",
            SURV: "55000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "33.3",
            LATP: "54.8",
            SURV: "37000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "32",
            LATP: "54.6",
            SURV: "24000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "30.4",
            LATP: "54.4",
            SURV: "20000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "29.2",
            LATP: "54.4",
            SURV: "20000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "28.5",
            LATP: "54.3",
            SURV: "20000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "28.3",
            LATP: "54.4",
            SURV: "20000",
            DIR: "R",
            DIV: "1",
        }, {
            LONP: "24",
            LATP: "55.1",
            SURV: "60000",
            DIR: "A",
            DIV: "2",
        }, {
            LONP: "24.5",
            LATP: "55.2",
            SURV: "60000",
            DIR: "A",
            DIV: "2",
        }, {
            LONP: "25.5",
            LATP: "54.7",
            SURV: "60000",
            DIR: "A",
            DIV: "2",
        }, {
            LONP: "26.6",
            LATP: "55.7",
            SURV: "40000",
            DIR: "A",
            DIV: "2",
        }, {
            LONP: "27.4",
            LATP: "55.6",
            SURV: "33000",
            DIR: "A",
            DIV: "2",
        }, {
            LONP: "28.7",
            LATP: "55.5",
            SURV: "30000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "29.2",
            LATP: "54.3",
            SURV: "30000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "28.5",
            LATP: "54.2",
            SURV: "30000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "28.3",
            LATP: "54.3",
            SURV: "28000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "27.5",
            LATP: "54.5",
            SURV: "20000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "26.8",
            LATP: "54.3",
            SURV: "12000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "26.4",
            LATP: "54.4",
            SURV: "14000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "24.6",
            LATP: "54.5",
            SURV: "8000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "24.4",
            LATP: "54.4",
            SURV: "4000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "24.2",
            LATP: "54.4",
            SURV: "4000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "24.1",
            LATP: "54.3",
            SURV: "4000",
            DIR: "R",
            DIV: "2",
        }, {
            LONP: "24",
            LATP: "55.2",
            SURV: "22000",
            DIR: "A",
            DIV: "3",
        }, {
            LONP: "24.5",
            LATP: "55.3",
            SURV: "22000",
            DIR: "A",
            DIV: "3",
        }, {
            LONP: "24.6",
            LATP: "55.8",
            SURV: "6000",
            DIR: "R",
            DIV: "3",
        }, {
            LONP: "24.2",
            LATP: "54.4",
            SURV: "6000",
            DIR: "R",
            DIV: "3",
        }, {
            LONP: "24.1",
            LATP: "54.3",
            SURV: "6000",
            DIR: "R",
            DIV: "3",
        }, ];

        var cityData = [];
        var tempData = [];
        var survivalData = [];
        var div1Data = [];
        var div2Data = [];
        var div3Data = [];

        formatData();

        var container = d3
            .select("body")
            .append("section")
            .attr("class", "vis")
            .append("div");

        var svgContainer = container.append("svg").attr("viewBox", "0 0 800 600");
        var groupCon = svgContainer
            .append("g")
            .attr("transform", "translate(100, 100)");
        var groupContainer = groupCon
            .append("g")
            .attr("transform", "translate(0, 200)");
        // Create scale
        var scaleX = d3
            .scaleLinear()
            .domain([
                d3.min(survivalData, function(d) {
                    return d.LONP;
                }) - 0.5,
                d3.max(survivalData, function(d) {
                    return d.LONP;
                }),
            ])
            .range([0, 600]);

        var scaleY = d3
            .scaleLinear()
            .domain([
                d3.min(survivalData, function(d) {
                    return d.LATP;
                }) - 0.5,
                d3.max(survivalData, function(d) {
                    return d.LATP;
                }),
            ])
            .range([200, 0]);

        var scaleSize = d3
            .scaleLinear()
            .domain([
                d3.min(survivalData, function(d) {
                    return d.SURV;
                }),
                d3.max(survivalData, function(d) {
                    return d.SURV;
                }),
            ])
            .range([1, 10]);
        // Add scales to axis
        var x_axis = d3.axisBottom().scale(scaleX);
        var y_axis = d3.axisLeft().scale(scaleY);

        //Insert x axis
        groupContainer.call(x_axis);

        //Append group and insert y axis
        groupContainer = groupCon.append("g");
        groupContainer.call(y_axis);

        var survivalGroup = groupCon.append("g").attr("id", "group-div1");
        // .attr("transform", "translate(53, 100)");

        survivalGroup
            .selectAll("line#surv")
            .data(div1Data)
            .enter()
            .append("line")
            .attr("x1", function(d, i) {
                return scaleX(d.LONP);
            })
            .attr("x2", function(d, i) {
                var index = i + 1 == div1Data.length ? 0 : i + 1;
                return scaleX(div1Data[index].LONP);
            })
            .attr("y1", function(d) {
                return scaleY(d.LATP);
            })
            .attr("y2", function(d, i) {
                var index = i + 1 == div1Data.length ? 0 : i + 1;
                return scaleY(div1Data[index].LATP);
            })
            .attr("stroke", function(d) {
                return d.DIR == "A" ? "red" : "blue";
            })
            .attr("stroke-width", function(d) {
                return scaleSize(d.SURV);
            });
        var survivalGroup = groupCon.append("g").attr("id", "group-div2");
        // .attr("transform", "translate(53, 100)");

        survivalGroup
            .selectAll("line#surv")
            .data(div2Data)
            .enter()
            .append("line")
            .attr("x1", function(d, i) {
                return scaleX(d.LONP);
            })
            .attr("x2", function(d, i) {
                var index = i + 1 == div2Data.length ? 0 : i + 1;
                return scaleX(div2Data[index].LONP);
            })
            .attr("y1", function(d) {
                return scaleY(d.LATP);
            })
            .attr("y2", function(d, i) {
                var index = i + 1 == div2Data.length ? 0 : i + 1;
                return scaleY(div2Data[index].LATP);
            })
            .attr("stroke", function(d) {
                return d.DIR == "A" ? "red" : "blue";
            })
            .attr("stroke-width", function(d) {
                return scaleSize(d.SURV);
            });
        var survivalGroup = groupCon.append("g").attr("id", "group-div3");
        // .attr("transform", "translate(53, 100)");

        survivalGroup
            .selectAll("line#surv")
            .data(div3Data)
            .enter()
            .append("line")
            .attr("x1", function(d, i) {
                return scaleX(d.LONP);
            })
            .attr("x2", function(d, i) {
                var index = i + 1 == div3Data.length ? 0 : i + 1;
                return scaleX(div3Data[index].LONP);
            })
            .attr("y1", function(d) {
                return scaleY(d.LATP);
            })
            .attr("y2", function(d, i) {
                var index = i + 1 == div3Data.length ? 0 : i + 1;
                return scaleY(div3Data[index].LATP);
            })
            .attr("stroke", function(d) {
                return d.DIR == "A" ? "red" : "blue";
            })
            .attr("stroke-width", function(d) {
                return scaleSize(d.SURV);
            });

        var citiesGroup = groupCon.append("g");
        // .attr("transform", "translate(54, 61)");

        citiesGroup
            .selectAll("circle#cities")
            .data(cityData)
            .enter()
            .append("circle")
            .attr("cx", function(d) {
                return scaleX(d.LONC);
            })
            .attr("cy", function(d) {
                return scaleY(d.LATC);
            })
            .attr("r", function(d) {
                return 2;
            })
            .style("fill", "white");

        citiesGroup
            .selectAll("text#cityName")
            .data(cityData)
            .enter()
            .append("text")
            .attr("x", function(d) {
                return scaleX(d.LONC);
            })
            .attr("y", function(d) {
                return scaleY(d.LATC);
            })
            .attr("dy", -10)
            .attr("dx", -20)
            .style("font-size", "10px")
            .text(function(d) {
                return d.CITY;
            })
            .style("fill", "white");
        var legendData = [{
            label: "Division 1",
            color: "#FED65D",
        }, {
            label: "Division 2",
            color: "#31A19A",
        }, {
            label: "Division 3",
            color: "#6D4258",
        }, ];
        var legendRectSize = 15;
        var legendSpacing = 4;
        legendGroup = svgContainer
            .append("g")
            .attr("class", "legend-group")
            .attr("transform", "translate(50, 30)")
            .style("font-size", "12px");

        var legend = legendGroup
            .selectAll(".legend")
            .data(legendData)
            .enter()
            .append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) {
                var height = legendRectSize + legendSpacing;
                var offset = (height * 5) / 4;
                var horz = -2 * legendRectSize;
                var vert = i * height - offset;
                return "translate(" + horz + "," + vert + ")";
            })
            .on("mouseenter", function(d) {
                var show = 1;
                var hide = 0;
                // Hide/show the elements
                if (d.label == "Division 1") {
                    d3.select("#group-div1").style("opacity", show);
                    d3.select("#group-div2").style("opacity", hide);
                    d3.select("#group-div3").style("opacity", hide);
                } else if (d.label == "Division 2") {
                    d3.select("#group-div1").style("opacity", hide);
                    d3.select("#group-div2").style("opacity", show);
                    d3.select("#group-div3").style("opacity", hide);
                } else {
                    d3.select("#group-div1").style("opacity", hide);
                    d3.select("#group-div2").style("opacity", hide);
                    d3.select("#group-div3").style("opacity", show);
                }
            })
            .on("mouseleave", function(d) {
                var show = 1;
                var hide = 0;
                // Hide/show the elements
                if (d.label == "Division 1") {
                    d3.select("#group-div1").style("opacity", show);
                    d3.select("#group-div2").style("opacity", show);
                    d3.select("#group-div3").style("opacity", show);
                } else if (d.label == "Division 2") {
                    d3.select("#group-div1").style("opacity", show);
                    d3.select("#group-div2").style("opacity", show);
                    d3.select("#group-div3").style("opacity", show);
                } else {
                    d3.select("#group-div1").style("opacity", hide);
                    d3.select("#group-div2").style("opacity", show);
                    d3.select("#group-div3").style("opacity", show);
                }
            });
        legendData = [{
            label: "Arrival",
            color: "red",
        }, {
            label: "Retreat",
            color: "blue",
        }, {
            label: "Temperature",
            color: "grey",
        }, ];

        legend
            .append("rect")
            .attr("width", 5)
            .attr("height", 5)
            .style("fill", function(d) {
                return "white";
            })
            .style("stroke", function(d) {
                return "white";
            });

        legend
            .append("text")
            .attr("x", legendRectSize + legendSpacing)
            .attr("y", legendRectSize - legendSpacing)
            .style("fill", "white")
            .text(function(d) {
                return d.label;
            });

        legendGroup = svgContainer
            .append("g")
            .attr("class", "legend-group2")
            .attr("transform", "translate(700, 30)")
            .style("font-size", "12px");

        legend = legendGroup
            .selectAll(".legend")
            .data(legendData)
            .enter()
            .append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) {
                var height = legendRectSize + legendSpacing;
                var offset = (height * 5) / 4;
                var horz = -2 * legendRectSize;
                var vert = i * height - offset;
                return "translate(" + horz + "," + vert + ")";
            });

        legend
            .append("rect")
            .attr("width", legendRectSize)
            .attr("height", legendRectSize)
            .style("fill", function(d) {
                return d.color;
            })
            .style("stroke", function(d) {
                return d.color;
            });

        legend
            .append("text")
            .attr("x", legendRectSize + legendSpacing)
            .attr("y", legendRectSize - legendSpacing)
            .style("fill", "white")
            .text(function(d) {
                return d.label;
            });

        var scaleYTemp = d3
            .scaleLinear()
            .domain([
                d3.min(tempData, function(d) {
                    return d.TEMP;
                }) - 0.5,
                d3.max(tempData, function(d) {
                    return d.TEMP;
                }),
            ])
            .range([200, 0]);

        var scaleXTemp = d3
            .scaleLinear()
            .domain([
                d3.min(tempData, function(d) {
                    return d.LONT;
                }) - 2,
                d3.max(tempData, function(d) {
                    return d.LONT;
                }),
            ])
            .range([0, 600]);

        // Add scales to axis
        var ytemp_axis = d3.axisRight().scale(scaleYTemp);
        groupCon
            .append("text")
            .attr("text-anchor", "end")
            .attr("x", 330)
            .attr("y", 240)
            .style("fill", "white")
            .text("Longitude");

        // Y axis label:
        groupCon
            .append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("y", 650)
            .attr("x", -300)
            .style("fill", "white")
            .text("Temperature");
        groupCon
            .append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("y", -50)
            .attr("x", -50)
            .style("fill", "white")
            .text("Latitude");
        //Append group and insert y axis
        groupContainer = groupCon
            .append("g")
            .attr("id", "temp-group")
            .attr("transform", "translate(600, 230)");
        groupContainer.call(ytemp_axis);

        var tempGroup = groupCon
            .append("g")
            .attr("id", "group-tempp")
            .attr("transform", "translate(0, 230)");

        tempGroup
            .append("path")
            .datum(tempData)
            .attr("fill", "none")
            .attr("stroke", "grey")
            .attr("stroke-width", 2)
            .attr(
                "d",
                d3
                .line()
                .x(function(d) {
                    return scaleXTemp(d.LONT);
                })
                .y(function(d) {
                    return scaleYTemp(d.TEMP);
                })
            );

        function formatData() {
            for (var i = 0; i < data.length; i++) {
                if (data[i].LONC && data[i].LONC != "") {
                    cityData.push({
                        LONC: parseFloat(data[i].LONC),
                        LATC: parseFloat(data[i].LATC),
                        CITY: data[i].CITY,
                    });
                }
                if (data[i].LONT && data[i].LONT != "") {
                    tempData.push({
                        LONT: parseFloat(data[i].LONT),
                        TEMP: parseFloat(data[i].TEMP),
                        DAYS: data[i].DAYS,
                        MON: data[i].MON,
                        DAY: data[i].DAY,
                    });
                }
                if (data[i].LONP && data[i].LONP != "") {
                    var d = {
                        LONP: parseFloat(data[i].LONP),
                        LATP: parseFloat(data[i].LATP),
                        SURV: parseFloat(data[i].SURV),
                        DIR: data[i].DIR,
                        DIV: data[i].DIV,
                    };
                    if (data[i].DIV == "1") {
                        div1Data.push(d);
                    } else if (data[i].DIV == "2") {
                        div2Data.push(d);
                    } else {
                        div3Data.push(d);
                    }
                    survivalData.push(d);
                }
            }
        }
    </script>
</body>

</html>